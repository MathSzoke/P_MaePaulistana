@page "/newPatient"
@using MaePaulistana.Controllers;
@model NewPatient

<div class="body-new-register">
    <div class="container-one-new-register">
        <div class="content-ipt">
            <label for="name" class="label-column unselectable"><span class="required">*</span>Nome:</label><input type="text" name="name" id="nameIpt" class="ipt-name" placeholder="Nome Completo" required>
        </div>
        <div class="content-ipt">
            <label for="birth-date" class="label-column unselectable">
                <span class="required">*</span>Data nascimento:
            </label>
            <input type="date" id="birthDate" required class="ipt-birth-date" />
        </div>
        <div class="content-ipt">
            <label for="unit" class="label-column unselectable"><span class="required">*</span>Unidade:</label>
            <select name="unit" class="select-units" id="unit" required>
                <option selected value="null" disabled>Selecionar</option>
                @foreach (var estabelecimento in Model.Estabelecimentos!)
                {
                    <option value="@estabelecimento.EstabelecimentoId">@estabelecimento.EstabelecimentoNome</option>
                }
            </select>
        </div>
        <div class="content-ipt">
            <label for="attendant-type" class="label-column unselectable">
                <span class="required">*</span>Tipo atendimento:
            </label>
            <select name="attendant-type" class="select-attendant-types" placeholder="Selecionar" required>
                <option value="null" selected disabled>Selecionar</option>
                @foreach (var attendantType in Model.TiposAtendimento!)
                {
                    <option value="@attendantType.TipoAtendimentoID">@attendantType.DescTipoAtendimento</option>
                }
            </select>
        </div>
        <div class="content-ipt qualification-citizen">
            <label class="label-column unselectable"><span class="required">*</span>Qualificação da munícipe:</label>
            <div class="container-ipt-radio">
                @foreach (var qualificationCitizen in Model.QualificacaoMunicipes!)
                {
                    <div class="area-ipt-radio">
                        <label class="checkbox-label unselectable">
                            <input type="radio" value="@qualificationCitizen.QualificacaoID" name="qualificationCitizen" />
                            @qualificationCitizen.QualificacaoDesc
                        </label>
                    </div>
                }
            </div>
        </div>
    </div>

    <div class="container-two-new-register">
        <div class="content-ipt">
            <label for="cpf" class="label-column unselectable"><span class="required">*</span>CPF:</label><input type="text" id="cpf" class="ipt-cpf no-spinners" placeholder="xxx.xxx.xxx-xx" required />
        </div>
        <div class="content-ipt">
            <label for="cns" class="label-column unselectable"><span class="required">*</span>CNS:</label><input type="text" id="cns" class="ipt-cns no-spinners" placeholder="xxx xxxx xxxx xxxx" required />
        </div>
        <div class="content-ipt">
            <label for="dum" class="label-column unselectable"><span class="required">*</span>DUM:</label><input type="date" id="dum" class="ipt-dum" required />
        </div>
        <div class="content-ipt">
            <label for="name" class="label-column unselectable"><span class="required">*</span>Previsão parto:</label><input type="date" id="prevision-forecast" class="ipt-prevision-forecast" required />
        </div>
    </div>
</div>

<div class="register-telephone" style="display:none">
    <div class="modal-header header-telephone">
        <span class="title-table-data">
            <h3 class="unselectable">Cadastrar telefones</h3>
        </span>
    </div>
    <div class="div-table-telephone">
        <table class="table-data new-telephones">
            <thead>
                <tr class="row-data">
                    <th class="column-data unselectable"></th>
                    <th class="column-data unselectable">Telefone</th>
                    <th class="column-data unselectable">Tipo</th>
                    <th class="column-data unselectable">Observações</th>
                </tr>
            </thead>
            <tbody class="new-rows-added"></tbody>
            <tbody>
                <tr class="row-data">
                    <td class="data-cell">
                        <div class="contents-details-person">
                            <div class="eye-data">
                                <svg xmlns="http://www.w3.org/2000/svg" width="20" height="20" fill="currentColor" class="bi bi-eye-fill" viewBox="0 0 16 16">
                                    <path d="M10.5 8a2.5 2.5 0 1 1-5 0 2.5 2.5 0 0 1 5 0z" />
                                    <path d="M0 8s3-5.5 8-5.5S16 8 16 8s-3 5.5-8 5.5S0 8 0 8zm8 3.5a3.5 3.5 0 1 0 0-7 3.5 3.5 0 0 0 0 7z" />
                                </svg>
                            </div>
                            <div class="register-call-data">
                                <svg xmlns="http://www.w3.org/2000/svg" width="20" height="20" fill="currentColor" class="bi bi-telephone" viewBox="0 0 16 16">
                                    <path d="M3.654 1.328a.678.678 0 0 0-1.015-.063L1.605 2.3c-.483.484-.661 1.169-.45 1.77a17.568 17.568 0 0 0 4.168 6.608 17.569 17.569 0 0 0 6.608 4.168c.601.211 1.286.033 1.77-.45l1.034-1.034a.678.678 0 0 0-.063-1.015l-2.307-1.794a.678.678 0 0 0-.58-.122l-2.19.547a1.745 1.745 0 0 1-1.657-.459L5.482 8.062a1.745 1.745 0 0 1-.46-1.657l.548-2.19a.678.678 0 0 0-.122-.58L3.654 1.328zM1.884.511a1.745 1.745 0 0 1 2.612.163L6.29 2.98c.329.423.445.974.315 1.494l-.547 2.19a.678.678 0 0 0 .178.643l2.457 2.457a.678.678 0 0 0 .644.178l2.189-.547a1.745 1.745 0 0 1 1.494.315l2.306 1.794c.829.645.905 1.87.163 2.611l-1.034 1.034c-.74.74-1.846 1.065-2.877.702a18.634 18.634 0 0 1-7.01-4.42 18.634 18.634 0 0 1-4.42-7.009c-.362-1.03-.037-2.137.703-2.877L1.885.511z" />
                                </svg>
                            </div>
                        </div>
                    </td>
                    <td class="data-cell td-customize-table">
                        <input type="tel" id="phone" class="ipt-telephone customize-table-ipt" minlength="15" maxlength="16" placeholder="(xx) x xxxx-xxxx" required>
                    </td>
                    <td class="data-cell td-customize-table">
                        <select name="type-telephone" id="selectTypeTel" class="select-type-telephone customize-table-ipt" required>
                            <option value="null" selected disabled>Selecionar</option>
                            @foreach (var tipoTelefone in Model.TipoTelefoneList!)
                            {
                                <option value="@tipoTelefone.TipoTelefoneID">@tipoTelefone.DescricaoTipoTelefone</option>
                            }
                        </select>
                    </td>
                    <td class="data-cell td-customize-table">
                        <textarea rows="4" cols="50" class="ipt-obs customize-table-ipt" id="textareaObs" style='height: 80px;' placeholder="Observações aqui"></textarea>
                    </td>
                    <td colspan="5" style="border: none !important;">
                        <div class="area-to-add-telephone">
                            <button class="btn" type="submit" id="add-phone-button" onclick="addNewTelephone()">
                                <svg xmlns="http://www.w3.org/2000/svg" width="30" height="30" fill="currentColor" class="bi bi-node-plus" viewBox="0 0 16 16">
                                    <path fill-rule="evenodd" d="M11 4a4 4 0 1 0 0 8 4 4 0 0 0 0-8zM6.025 7.5a5 5 0 1 1 0 1H4A1.5 1.5 0 0 1 2.5 10h-1A1.5 1.5 0 0 1 0 8.5v-1A1.5 1.5 0 0 1 1.5 6h1A1.5 1.5 0 0 1 4 7.5h2.025zM11 5a.5.5 0 0 1 .5.5v2h2a.5.5 0 0 1 0 1h-2v2a.5.5 0 0 1-1 0v-2h-2a.5.5 0 0 1 0-1h2v-2A.5.5 0 0 1 11 5zM1.5 7a.5.5 0 0 0-.5.5v1a.5.5 0 0 0 .5.5h1a.5.5 0 0 0 .5-.5v-1a.5.5 0 0 0-.5-.5h-1z" />
                                </svg>
                            </button>
                        </div>
                    </td>
                </tr>
            </tbody>
        </table>
    </div>
</div>

<div class="modal-footer">
    <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Cancelar</button>
    <button type="button" id="btnSavePatient" class="btn btn-success" onclick="SavePatient()">Salvar</button>
    <button type="button" id="btnStartCall" data-bs-target="#registerCallModalTeste" data-bs-toggle="modal" class="btn btn-success disabled start-call" style="display: none;" disabled>Iniciar ligação</button>
</div>

<div class="modal fade" id="registerCallModalTeste" tabindex="-1" aria-labelledby="registerCallModalLabel" aria-hidden="true">
    <div class="modal-dialog model-dialog-register-call">
        <div class="modal-content">
            <div class="modal-header">
                <h3 class="modal-title unselectable">Registrar ligações</h3>
                <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
            </div>
            <div class="modal-body modal-body-start-call">
            </div>
        </div>
    </div>
</div>

<script>
    $(function () {
        $('button.start-call').on('click', function () {
            $('.modal-body-start-call').load('/RegisterCall');
        })
    })

    document.getElementById("phone").oninput = (e) => {
        var typeValue = document.querySelector("#add-phone-button").closest("tr").querySelector(".select-type-telephone").value;
        let cursorPos = e.target.selectionStart
        let formatInput = typeValue === "RE" ? autoFormatPhoneNumberRecado(e.target) : autoFormatPhoneNumber(e.target)
        e.target.value = String(formatInput)
        let isBackspace = (e?.data == null) ? true : false
        let nextCusPos = nextDigit(formatInput, cursorPos, isBackspace)

        document.getElementById("phone").setSelectionRange(nextCusPos + 1, nextCusPos + 1);
    }

    document.getElementById("cpf").oninput = (e) => {
        let cursorPos = e.target.selectionStart
        let formatInput = cpfChange(e.target)
        e.target.value = String(formatInput)
        let isBackspace = (e?.data == null) ? true : false
        let nextCusPos = nextDigit(formatInput, cursorPos, isBackspace)

        document.getElementById("cpf").setSelectionRange(nextCusPos + 1, nextCusPos + 1);
    }

    document.getElementById("cns").oninput = (e) => {
        let cursorPos = e.target.selectionStart
        let formatInput = cnsChange(e.target)
        e.target.value = String(formatInput)
        let isBackspace = (e?.data == null) ? true : false
        let nextCusPos = nextDigit(formatInput, cursorPos, isBackspace)

        document.getElementById("cns").setSelectionRange(nextCusPos + 1, nextCusPos + 1);
    }
</script>
